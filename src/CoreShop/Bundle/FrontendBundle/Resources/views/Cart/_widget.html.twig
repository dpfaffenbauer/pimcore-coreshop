{% import '@CoreShopFrontend/Common/Macro/currency.html.twig' as currency %}

<div id="cart" class="cart-widget btn-group btn-block">
    <button type="button" class="btn btn-link dropdown-toggle d-flex align-items-center gap-2" data-bs-toggle="dropdown">
        <span class="cart-number">{% if cart.hasItems %}{{ cart.items|length }}{% else %}0{% endif %}</span>
        <i class="bi bi-cart"></i>
        <span class="cart-total" {{ coreshop_test_html_attribute('cart-total') }}>{{ currency.convertAndFormat(cart.total) }}</span>
    </button>

    <div class="dropdown-menu pull-right" aria-labelledby="dropdownMenuButton">
        <div class="pt-1 px-3">
            {% if cart.hasItems %}
                <div class="mb-2">
                    <ul class="list-group">
                        {% for item in cart.items %}
                            <li class="cart-widget-item list-group-item">
                                <div><a href="{{ pimcore_object_path(item.product) }}">{{ item.product.name }}</a></div>
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>x{{ item.quantity }} - <span>{{ currency.convertAndFormat(item.total) }}</span></div>
                                    <div class="cart-close-item">
                                        {% if not item.isGiftItem %}
                                            <a href="{{ path('coreshop_cart_remove', {cartItem: item.id|coreshop_string}) }}" class="removeFromCart" data-id="{{ item.id }}" data-refresh="true">
                                                <i class="bi bi-trash"></i>
                                            </a>
                                        {% endif %}
                                    </div>
                                </div>
                            </li>
                        {% endfor %}
                    </ul>
                </div>
                <div class="my-1">{{ 'coreshop.ui.subtotal'|trans }}: <span>{{ currency.convertAndFormat(cart.subtotal) }}</span></div>
                <div class="mb-3">{{ 'coreshop.ui.total'|trans }}: <span>{{ currency.convertAndFormat(cart.total) }}</span></div>
            {% endif %}
            <div class="d-flex gap-2">
                {% if is_granted('CORESHOP_CART_SUMMARY') %}
                    <a class="btn btn-secondary  d-flex align-items-center justify-content-center  " target="_self" href="{{ path('coreshop_cart_summary') }}">{{ 'coreshop.ui.cart'|trans }}</a>
                {% endif %}

                {% if is_granted('CORESHOP_CHECKOUT') %}
                    <a class="btn btn-primary  d-flex align-items-center justify-content-center  " target="_self" href="{{ path('coreshop_checkout', {'stepIdentifier': coreshop_checkout_steps_get_first()}) }}">{{ 'coreshop.ui.checkout'|trans }}</a>
                {% endif %}
            </div>
        </div>
    </div>

</div>
